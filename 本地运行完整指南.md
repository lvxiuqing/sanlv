# 本地运行完整指南

## 🚀 快速启动（3步）

### 第1步：配置环境变量

```bash
# 复制模板
copy .env.example .env.local

# 编辑 .env.local，填入 DeepSeek API Key
DEEPSEEK_API_KEY=sk-xxxxxxxxxxxxx
```

### 第2步：启动后端服务

打开**第一个终端窗口**：

```bash
npm run dev:server
```

**预期输出：**
```
╔════════════════════════════════════════╗
║    AI 分析服务已启动                   ║
║    地址: http://localhost:3001         ║
║    API: POST /api/analyze              ║
║    健康检查: GET /health               ║
╚════════════════════════════════════════╝
```

### 第3步：启动前端服务

打开**第二个终端窗口**：

```bash
npm run dev
```

**预期输出：**
```
VITE v5.4.20  ready in 884 ms

➜  Local:   http://localhost:3000/
➜  Network: use --host to expose
➜  press h + enter to show help
```

---

## 📱 访问应用

浏览器自动打开 `http://localhost:3000`

或手动访问：
```
http://localhost:3000
```

---

## 🎯 使用步骤

1. **登录系统**
   - 使用管理员账号登录
   - 用户名：admin
   - 密码：admin123（或首次登录设置的密码）

2. **进入成绩总览**
   - 点击菜单"成绩总览"

3. **选择数据**
   - 选择年级
   - 选择日期（可选）

4. **生成 AI 分析**
   - 点击"生成AI智能分析报告"按钮
   - 等待分析完成

5. **查看结果**
   - 弹窗显示 AI 分析报告
   - 支持复制文本

---

## 🔧 系统架构

```
┌─────────────────────────────────────────┐
│         浏览器 (http://localhost:3000)   │
│  ┌─────────────────────────────────────┐│
│  │  前端应用 (React + Vite)            ││
│  │  - 成绩总览页面                     ││
│  │  - AI 分析按钮                      ││
│  └─────────────────────────────────────┘│
└────────────────┬────────────────────────┘
                 │ /api/analyze (代理)
                 ↓
┌─────────────────────────────────────────┐
│    后端服务 (http://localhost:3001)     │
│  ┌─────────────────────────────────────┐│
│  │  Express 服务器                     ││
│  │  - API 接口                         ││
│  │  - Prompt 构建                      ││
│  └─────────────────────────────────────┘│
└────────────────┬────────────────────────┘
                 │ HTTP POST
                 ↓
┌─────────────────────────────────────────┐
│    DeepSeek API                         │
│  - 接收 Prompt                          │
│  - 生成分析报告                         │
│  - 流式返回结果                         │
└─────────────────────────────────────────┘
```

---

## 📊 服务信息

| 服务 | 端口 | 地址 | 说明 |
|------|------|------|------|
| 前端 | 3000 | http://localhost:3000 | React 应用 |
| 后端 | 3001 | http://localhost:3001 | Express API |
| 数据库 | - | Supabase | 云端数据库 |

---

## 🔌 API 代理

前端自动将 `/api` 请求代理到后端：

```javascript
// 前端请求
fetch('/api/analyze', {
  method: 'POST',
  body: JSON.stringify(data)
})

// 自动转发到
// http://localhost:3001/api/analyze
```

**配置文件：** `vite.config.js`

---

## 🛑 停止服务

### 停止单个服务
在对应的终端窗口按 `Ctrl+C`

### 停止所有服务
```bash
# Windows
taskkill /F /IM node.exe

# macOS/Linux
pkill -f node
```

---

## 🐛 常见问题

### Q1: 后端启动失败
**症状：** `Error: listen EADDRINUSE`

**解决：**
```bash
# 杀死占用端口的进程
taskkill /F /IM node.exe

# 重新启动
npm run dev:server
```

### Q2: 前端无法连接后端
**症状：** API 404 错误

**解决：**
1. 确保后端正在运行
2. 重启前端服务
3. 清除浏览器缓存

### Q3: AI 分析失败
**症状：** "未配置 DeepSeek API Key"

**解决：**
1. 检查 `.env.local` 是否存在
2. 验证 API Key 是否正确
3. 重启后端服务

### Q4: 分析文本不完整
**症状：** AI 分析中途中断

**解决：**
1. 检查网络连接
2. 查看浏览器控制台错误
3. 重新生成分析

---

## 📋 检查清单

启动前检查：

- [ ] Node.js 已安装（v14+）
- [ ] npm 已安装
- [ ] 依赖已安装（`npm install`）
- [ ] `.env.local` 文件存在
- [ ] `DEEPSEEK_API_KEY` 已配置
- [ ] 端口 3000、3001 未被占用

启动后检查：

- [ ] 后端服务正在运行
- [ ] 前端服务正在运行
- [ ] 浏览器可以访问 http://localhost:3000
- [ ] 浏览器控制台无错误
- [ ] 可以登录系统

---

## 🎓 项目结构

```
sanlv/
├── src/
│   ├── pages/
│   │   ├── OverviewPage.jsx      # 成绩总览页面
│   │   ├── ClassPage.jsx         # 班级数据页面
│   │   └── ...
│   ├── utils/
│   │   ├── storage.js            # 数据存储
│   │   ├── calculator.js         # 计算逻辑
│   │   └── ...
│   └── App.jsx                   # 主应用
├── server/
│   ├── index.js                  # 后端服务器
│   └── ai-analysis.js            # AI 分析逻辑
├── vite.config.js                # Vite 配置（含代理）
├── package.json                  # 项目配置
├── .env.example                  # 环境变量模板
└── .env.local                    # 环境变量（本地）
```

---

## 🔐 安全提示

1. ✅ **不要提交 `.env.local`** - 已在 `.gitignore` 中
2. ✅ **API Key 保存在后端** - 前端无法访问
3. ✅ **定期轮换 API Key** - 在 DeepSeek 控制台
4. ✅ **监控 API 使用量** - 避免超支

---

## 📚 相关文档

- `AI分析快速开始.md` - 快速启动指南
- `AI_ANALYSIS_SETUP.md` - 详细配置文档
- `API代理配置说明.md` - 代理配置说明
- `AI分析故障排除完整指南.md` - 故障排除

---

## 🎉 成功标志

当你看到以下现象时，说明一切正常：

1. ✅ 后端终端显示：`AI 分析服务已启动`
2. ✅ 前端终端显示：`VITE ... ready in ...`
3. ✅ 浏览器打开 http://localhost:3000
4. ✅ 可以正常登录
5. ✅ 点击"生成AI智能分析报告"后弹窗出现
6. ✅ AI 分析文本逐字显示
7. ✅ 分析完成后显示完整报告

---

## 🚀 下一步

1. **本地测试** - 完整测试所有功能
2. **推送到 GitHub** - `git push origin main`
3. **部署到 Zeabur** - 配置环境变量并自动部署

---

## 💬 需要帮助？

1. 查看浏览器控制台（F12）的错误信息
2. 查看后端终端的日志
3. 运行诊断工具：`快速验证.bat`
4. 查看相关文档

祝你使用愉快！🎊
