# 🔐 教师密码管理功能说明

## ✨ 功能概述

系统已升级为**教师自定义密码**功能，每位教师可以设置和管理自己的专属密码，大大提升了系统的安全性。

---

## 🎯 主要改进

### 之前的问题
- ❌ 密码规则简单（年级数字+0+班级号）
- ❌ 其他班级老师容易猜到密码
- ❌ 密码固定，无法修改
- ❌ 安全性较低

### 现在的优势
- ✅ 每位教师设置自己的专属密码
- ✅ 密码长度至少6位，更安全
- ✅ 支持随时修改密码
- ✅ 密码加密存储在云端
- ✅ 不同班级密码完全独立

---

## 📋 使用流程

### 1️⃣ 首次登录（设置密码）

**步骤：**

1. **打开登录页面**
   - 选择年级（如：一年级）
   - 输入班级号（如：1）
   - 输入任意密码（用于触发设置流程）

2. **系统检测首次登录**
   - 弹出"首次登录 - 设置密码"窗口
   - 显示欢迎信息

3. **设置专属密码**
   - 输入新密码（至少6位）
   - 再次确认新密码
   - 点击"确认设置"

4. **完成设置**
   - 系统提示"密码设置成功！"
   - 返回登录页面
   - 使用刚设置的密码登录

**示例：**
```
一年级1班老师首次登录：
1. 选择：一年级
2. 输入：1
3. 输入任意密码触发设置
4. 设置新密码：teacher123456
5. 确认密码：teacher123456
6. 完成！下次使用 teacher123456 登录
```

---

### 2️⃣ 日常登录

**步骤：**

1. 选择年级
2. 输入班级号
3. 输入您设置的密码
4. 点击"登录"

**提示：**
- 如果密码错误，系统会提示"密码错误，请重试"
- 请确保使用您自己设置的密码

---

### 3️⃣ 修改密码

**步骤：**

1. **进入修改密码页面**
   - 登录系统后
   - 点击左侧菜单"🔐 修改密码"

2. **填写密码信息**
   - 输入原密码
   - 输入新密码（至少6位）
   - 再次确认新密码

3. **提交修改**
   - 点击"确认修改"
   - 系统验证原密码是否正确
   - 验证通过后更新密码

4. **完成修改**
   - 系统提示"密码修改成功！"
   - 下次登录使用新密码

**注意事项：**
- ⚠️ 原密码必须正确才能修改
- ⚠️ 新密码不能与原密码相同
- ⚠️ 两次输入的新密码必须一致
- ⚠️ 修改后请牢记新密码

---

## 🔧 管理员功能

### 管理员登录
- 年级：任意
- 班级：任意
- 密码：`admin123`

### 管理员权限
- 查看所有年级和班级的数据
- 管理系统数据
- **注意：** 管理员密码保持不变

---

## 💾 数据库配置

### 创建教师表

需要在 Supabase 中执行以下 SQL 语句：

```sql
-- 创建教师表
CREATE TABLE IF NOT EXISTS teachers (
  id BIGSERIAL PRIMARY KEY,
  grade_class TEXT UNIQUE NOT NULL,
  grade TEXT NOT NULL,
  class INTEGER NOT NULL,
  password_hash TEXT NOT NULL,
  created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
  updated_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
);

-- 创建索引
CREATE INDEX IF NOT EXISTS idx_teachers_grade_class ON teachers(grade_class);
CREATE INDEX IF NOT EXISTS idx_teachers_grade ON teachers(grade);
CREATE INDEX IF NOT EXISTS idx_teachers_class ON teachers(class);
```

### 执行步骤

1. **登录 Supabase**
   - 访问：https://supabase.com
   - 登录您的账号

2. **进入 SQL 编辑器**
   - 选择您的项目
   - 点击左侧菜单 "SQL Editor"
   - 点击 "New Query"

3. **执行 SQL**
   - 复制 `supabase_teachers_table.sql` 文件中的内容
   - 粘贴到编辑器
   - 点击 "Run" 执行

4. **验证创建**
   - 点击左侧 "Table Editor"
   - 查看是否有 `teachers` 表
   - 确认表结构正确

---

## 🔒 安全特性

### 密码加密
- 使用 SHA-256 哈希算法
- 密码不以明文存储
- 即使数据库泄露也无法还原密码

### 密码要求
- 最小长度：6位字符
- 可包含字母、数字、符号
- 建议使用复杂密码

### 推荐密码示例
- ✅ `teacher2024`
- ✅ `class1@2024`
- ✅ `mypassword123`
- ❌ `123456`（过于简单）
- ❌ `111111`（过于简单）

---

## 🎓 常见问题

### Q1: 忘记密码怎么办？
**A:** 目前需要联系管理员重置密码。后续可以添加密码找回功能。

**临时解决方案：**
1. 联系系统管理员
2. 管理员在 Supabase 中删除该教师记录
3. 教师重新首次登录设置新密码

**Supabase 操作：**
```sql
-- 删除指定教师记录（管理员操作）
DELETE FROM teachers WHERE grade_class = '一_1';
```

---

### Q2: 首次登录时输入什么密码？
**A:** 首次登录时输入任意密码即可触发设置流程，系统会自动弹出密码设置窗口。

---

### Q3: 修改密码后立即生效吗？
**A:** 是的，修改密码后立即生效。下次登录必须使用新密码。

---

### Q4: 可以设置多简单的密码？
**A:** 密码最少6位字符。建议使用复杂密码以提高安全性。

---

### Q5: 多个老师可以使用同一个账号吗？
**A:** 不建议。每个班级应该有独立的密码，由班主任管理。

---

### Q6: 密码会过期吗？
**A:** 目前密码不会过期，但建议定期更换密码。

---

### Q7: 如何查看已设置密码的班级？
**A:** 管理员可以在 Supabase 的 `teachers` 表中查看所有已设置密码的班级。

---

## 🚀 部署步骤

### 1. 更新代码
```bash
# 拉取最新代码（如果使用 Git）
git pull

# 或者直接替换文件
```

### 2. 创建数据库表
- 在 Supabase 中执行 `supabase_teachers_table.sql`

### 3. 重启系统
```bash
# 停止当前服务（Ctrl+C）
# 重新启动
npm run dev
```

### 4. 测试功能
- [ ] 测试首次登录设置密码
- [ ] 测试使用设置的密码登录
- [ ] 测试修改密码功能
- [ ] 测试密码错误提示

---

## 📊 技术实现

### 文件结构
```
src/
├── utils/
│   └── auth.js              # 密码管理工具函数
├── pages/
│   ├── LoginPage.jsx        # 登录页面（含首次设置）
│   └── PasswordPage.jsx     # 修改密码页面
└── App.jsx                  # 添加密码页面路由
```

### 核心功能

**auth.js 提供的函数：**
- `getTeacher()` - 获取教师信息
- `createTeacher()` - 创建教师账号
- `verifyTeacherPassword()` - 验证密码
- `changeTeacherPassword()` - 修改密码
- `resetTeacherPassword()` - 重置密码（管理员）
- `getAllTeachers()` - 获取所有教师（管理员）

---

## 🎉 功能优势总结

### 安全性提升
- ✅ 每个班级独立密码
- ✅ 密码加密存储
- ✅ 支持随时修改
- ✅ 密码长度要求

### 用户体验
- ✅ 首次登录引导设置
- ✅ 修改密码操作简单
- ✅ 清晰的提示信息
- ✅ 友好的错误提示

### 管理便捷
- ✅ 云端统一管理
- ✅ 支持多教师协作
- ✅ 管理员权限保留
- ✅ 数据永久保存

---

## 📞 技术支持

如果遇到问题，请检查：

1. **数据库表是否创建**
   - 登录 Supabase
   - 检查 `teachers` 表是否存在

2. **网络连接**
   - 确保能访问 Supabase

3. **浏览器控制台**
   - 按 F12 查看错误信息

4. **清除缓存**
   - 清除浏览器缓存后重试

---

## 🔄 后续优化建议

### 可添加的功能
1. **密码找回**
   - 通过邮箱或手机找回
   - 安全问题验证

2. **密码强度检测**
   - 实时显示密码强度
   - 提示密码安全性

3. **登录日志**
   - 记录登录时间
   - 记录登录IP

4. **密码过期提醒**
   - 定期提醒更换密码
   - 强制定期更换

5. **多因素认证**
   - 手机验证码
   - 邮箱验证

---

## ✅ 测试清单

部署后请测试以下功能：

- [ ] 首次登录能正常设置密码
- [ ] 使用设置的密码能成功登录
- [ ] 密码错误时显示正确提示
- [ ] 能进入修改密码页面
- [ ] 修改密码功能正常
- [ ] 原密码错误时无法修改
- [ ] 新密码生效，能正常登录
- [ ] 管理员登录不受影响
- [ ] 多个班级密码互不影响

---

**祝您使用愉快！** 🎉

如有任何问题或需要添加新功能，请随时联系！
